title: "[API] Ручка регистрации webhook подписок"
status: open
created_at: 15.02.2026
completed_at: null

todoist:
  task_id: "6g2m9HJjHjfxR5hH"

description: |
  В центральном API (estate_kit) нужна ручка POST /webhooks для регистрации
  webhook-подписок от клиентов (Odoo, боты и т.д.).

  Сейчас Odoo уже вызывает POST /webhooks при сохранении настроек
  (res_config_settings.py:_register_webhook), но нужно убедиться что API
  поддерживает новые типы событий:
  - property.locked — объект заблокирован другим агентством
  - property.unlocked — блокировка снята

  API должен:
  1. Принимать POST /webhooks с url, secret, events[]
  2. Хранить подписки
  3. При событии блокировки/разблокировки — рассылать webhook всем подписчикам
  4. DELETE /webhooks/{id} — удаление подписки (уже используется Odoo)

  Это задача для проекта API, не для Odoo.

recommendation: |
  Проверить текущую реализацию POST /webhooks в API.
  Добавить поддержку событий property.locked и property.unlocked.
  Логика отправки: когда агентство берёт объект в работу → найти все
  подписки с event "property.locked" → отправить POST на url подписчика.

solution: null
