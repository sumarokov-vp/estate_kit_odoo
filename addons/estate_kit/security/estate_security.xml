<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="module_category_estate" model="ir.module.category">
        <field name="name">Estate Kit</field>
        <field name="sequence">10</field>
    </record>

    <!-- ============================================================ -->
    <!-- Privileges (каждая роль — отдельный privilege с одной группой = checkbox) -->
    <!-- ============================================================ -->

    <record id="privilege_estate_team_lead" model="res.groups.privilege">
        <field name="name">Team Lead</field>
        <field name="sequence">10</field>
        <field name="category_id" ref="module_category_estate"/>
    </record>

    <record id="privilege_estate_listing_agent" model="res.groups.privilege">
        <field name="name">Listing Agent</field>
        <field name="sequence">20</field>
        <field name="category_id" ref="module_category_estate"/>
    </record>

    <record id="privilege_estate_buyer_agent" model="res.groups.privilege">
        <field name="name">Buyer's Agent</field>
        <field name="sequence">30</field>
        <field name="category_id" ref="module_category_estate"/>
    </record>

    <record id="privilege_estate_isa" model="res.groups.privilege">
        <field name="name">ISA</field>
        <field name="sequence">40</field>
        <field name="category_id" ref="module_category_estate"/>
    </record>

    <record id="privilege_estate_listing_coordinator" model="res.groups.privilege">
        <field name="name">Listing Coordinator</field>
        <field name="sequence">50</field>
        <field name="category_id" ref="module_category_estate"/>
    </record>

    <record id="privilege_estate_transaction_coordinator" model="res.groups.privilege">
        <field name="name">Transaction Coordinator</field>
        <field name="sequence">60</field>
        <field name="category_id" ref="module_category_estate"/>
    </record>

    <!-- ============================================================ -->
    <!-- Группы (каждая привязана к своему privilege) -->
    <!-- ============================================================ -->

    <record id="group_estate_team_lead" model="res.groups">
        <field name="name">Team Lead</field>
        <field name="privilege_id" ref="privilege_estate_team_lead"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="group_estate_listing_agent" model="res.groups">
        <field name="name">Listing Agent</field>
        <field name="privilege_id" ref="privilege_estate_listing_agent"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="group_estate_buyer_agent" model="res.groups">
        <field name="name">Buyer's Agent</field>
        <field name="privilege_id" ref="privilege_estate_buyer_agent"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="group_estate_isa" model="res.groups">
        <field name="name">ISA</field>
        <field name="privilege_id" ref="privilege_estate_isa"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="group_estate_listing_coordinator" model="res.groups">
        <field name="name">Listing Coordinator</field>
        <field name="privilege_id" ref="privilege_estate_listing_coordinator"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="group_estate_transaction_coordinator" model="res.groups">
        <field name="name">Transaction Coordinator</field>
        <field name="privilege_id" ref="privilege_estate_transaction_coordinator"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- ============================================================ -->
    <!-- Удаление старых групп                                       -->
    <!-- ============================================================ -->

    <delete model="res.groups" search="[('privilege_id.category_id', '=', ref('module_category_estate')), ('name', 'in', ['User', 'Agent', 'Coordinator', 'Manager'])]"/>

    <!-- ============================================================ -->
    <!-- Record Rules для estate.property                            -->
    <!-- ============================================================ -->

    <record id="rule_property_team_lead" model="ir.rule">
        <field name="name">Team Lead: все записи</field>
        <field name="model_id" ref="model_estate_property"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('group_estate_team_lead'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <record id="rule_property_listing_coordinator" model="ir.rule">
        <field name="name">Listing Coordinator: все записи</field>
        <field name="model_id" ref="model_estate_property"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('group_estate_listing_coordinator'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_property_transaction_coordinator" model="ir.rule">
        <field name="name">Transaction Coordinator: все записи</field>
        <field name="model_id" ref="model_estate_property"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('group_estate_transaction_coordinator'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_property_listing_agent" model="ir.rule">
        <field name="name">Listing Agent: свои + открытые</field>
        <field name="model_id" ref="model_estate_property"/>
        <field name="domain_force">['|','|',('user_id','=',user.id),('listing_agent_id','=',user.id),('is_shared','=',True)]</field>
        <field name="groups" eval="[(4, ref('group_estate_listing_agent'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_property_buyer_agent" model="ir.rule">
        <field name="name">Buyer's Agent: опубликованные + свои</field>
        <field name="model_id" ref="model_estate_property"/>
        <field name="domain_force">['|',('state','=','published'),('user_id','=',user.id)]</field>
        <field name="groups" eval="[(4, ref('group_estate_buyer_agent'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_property_isa" model="ir.rule">
        <field name="name">ISA: опубликованные + свои</field>
        <field name="model_id" ref="model_estate_property"/>
        <field name="domain_force">['|',('state','=','published'),('user_id','=',user.id)]</field>
        <field name="groups" eval="[(4, ref('group_estate_isa'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>
</odoo>
